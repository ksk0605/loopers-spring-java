# 요구사항 명세

## 공통 비기능적 요구사항 (Common Non-Functional Requirements)

### 인증 및 보안
- 사용자 인증은 `X-USER-ID` Header 기반으로 처리된다
- 모든 API 요청은 적절한 권한 검증을 거쳐야 한다
- 민감한 데이터는 암호화되어 저장되어야 한다
- 사용자별 데이터는 완전히 격리되어야 한다

### 오류 처리
- 오류 상황에서는 명확한 HTTP 상태코드와 에러메세지를 반환해야 한다
- 시스템 오류와 비즈니스 오류를 구분하여 처리해야 한다
- 오류 로그는 적절한 수준으로 기록되어야 한다
- 사용자에게 친화적인 오류 메시지를 제공해야 한다

### 데이터 일관성
- 트랜잭션 처리가 필요한 작업은 ACID 속성을 보장해야 한다
- 동시 수정 시 데이터 무결성이 보장되어야 한다

### 성능
- 동시 사용자 1000명 지원
- API 응답 시간은 각 도메인별 요구사항을 준수해야 한다

## 상품 / 브랜드

### 기능적 요구사항 (Functional Requirements)

#### < Happy Path > = 낙관적으로 동작하기를 기대하는 케이스

**상품 조회**
- 사용자는 상품 목록을 조회할 수 있다
- 사용자는 상품 상세 정보를 조회할 수 있다
- 사용자는 카테고리별로 상품을 필터링할 수 있다
- 사용자는 브랜드별로 상품을 필터링할 수 있다
- 사용자는 가격대별로 상품을 필터링할 수 있다
- 사용자는 정렬 기준(인기순, 가격순, 최신순)을 선택할 수 있다
- 상품 목록은 페이지네이션을 지원한다

**상품 검색**
- 사용자는 검색어로 상품을 검색할 수 있다
- 검색 결과는 관련성 순으로 정렬된다
- 사용자는 검색 결과를 필터링할 수 있다
- 검색 결과는 페이지네이션을 지원한다
- 최근 검색어 히스토리를 제공한다

**상품 좋아요**
- 로그인한 사용자는 상품에 좋아요를 등록할 수 있다
- 로그인한 사용자는 상품의 좋아요를 취소할 수 있다
- 로그인한 사용자는 좋아요한 상품 목록을 조회할 수 있다
- 좋아요한 상품 목록은 페이지네이션을 지원한다

#### < Fail Cases > = 실패 케이스

**상품 조회 실패**
- 존재하지 않는 상품을 조회하면 오류를 반환한다
- 삭제된 상품을 조회하면 오류를 반환한다
- 판매 중이지 않은 상품은 조회되지 않는다
- 로그인하지 않은 사용자가 좋아요한 상품 목록을 조회하면 오류를 반환한다

**상품 검색 실패**
- 검색어가 너무 짧으면 오류를 반환한다
- 검색어에 특수문자가 포함되면 오류를 반환한다
- 검색 시스템 장애 시 오류를 반환한다

**상품 좋아요 실패**
- 로그인하지 않은 사용자가 좋아요를 등록하면 오류를 반환한다
- 존재하지 않는 상품에 좋아요를 등록하면 오류를 반환한다
- 좋아요 등록/취소 중 시스템 오류가 발생하면 오류를 반환한다

### 비기능적 요구사항 (Non-Functional Requirements)

**성능**
- 상품 목록 조회 응답 시간: 500ms 이내
- 상품 검색 응답 시간: 1초 이내
- 상품 상세 조회 응답 시간: 300ms 이내

**확장성**
- 상품 수 증가에 따른 성능 저하 최소화
- 검색 기능은 확장 가능한 구조여야 한다

### 오류 코드 정의

| 케이스 | 설명 | HTTP 상태코드 | 에러 메시지 |
|--------|------|---------------|-------------|
| 상품 미존재 | 잘못된 productId | 404 NOT FOUND | "상품을 찾을 수 없습니다." |
| 브랜드 미존재 | 잘못된 brandId | 404 NOT FOUND | "브랜드를 찾을 수 없습니다." |
| 상품이 판매중 상태가 아님 | 상품이 판매중 외 상태 (일시품절, 판매중단 등) | 409 CONFLICT | "현재 판매 중이 아닌 상품입니다." |
| 미로그인 (좋아요 기능) | 인증 헤더 없음 | 401 UNAUTHORIZED | "로그인이 필요한 서비스입니다." |
| 상품 조회 중 예외 | DB 연결 실패, 시스템 오류 | 500 INTERNAL SERVER ERROR | "상품 조회 중 오류가 발생했습니다." |
| 검색어 너무 짧음 | 검색어가 2글자 미만 | 400 BAD REQUEST | "검색어는 2글자 이상 입력해주세요." |
| 검색어 특수문자 포함 | 검색어에 특수문자 포함 | 400 BAD REQUEST | "검색어에 특수문자를 포함할 수 없습니다." |
| 검색 시스템 장애 | 검색 엔진 연결 실패 | 503 SERVICE UNAVAILABLE | "검색 서비스가 일시적으로 사용할 수 없습니다." |

## 장바구니

### 기능적 요구사항 (Functional Requirements)

#### < Happy Path > = 낙관적으로 동작하기를 기대하는 케이스

**상품 추가**
- 로그인한 사용자는 장바구니에 상품을 추가할 수 있다
- 상품은 옵션 조합(사이즈, 색상 등)별로 별도 상품으로 처리된다
- 이미 장바구니에 있는 동일한 옵션 조합의 상품을 추가하면 수량이 증가한다
- 장바구니에 없는 옵션 조합의 상품을 추가하면 새 항목으로 추가된다

**장바구니 조회**
- 로그인한 사용자는 자신의 장바구니 목록을 조회할 수 있다
- 장바구니에는 상품명, 옵션 정보, 가격, 수량, 총액이 표시된다
- 장바구니 총 금액이 계산되어 표시된다

**수량 변경**
- 사용자는 장바구니 상품의 수량을 증가/감소시킬 수 있다
- 수량을 0으로 설정하면 해당 상품이 장바구니에서 제거된다

**상품 제거**
- 사용자는 장바구니에서 특정 상품을 개수에 상관없이 한번에 제거할 수 있다
- 사용자는 장바구니 전체를 한번에 비울 수 있다

#### < Fail Cases > = 실패 케이스

**상품 추가 실패**
- 로그인하지 않은 사용자가 상품을 추가하면 오류를 반환한다
- 존재하지 않는 상품을 추가하면 오류를 반환한다
- 존재하지 않는 옵션 조합의 상품을 추가하면 오류를 반환한다
- 판매 중이지 않은 상품을 추가하면 오류를 반환한다
- 재고보다 많은 수량을 추가하면 오류를 반환한다

**장바구니 조회 실패**
- 로그인하지 않은 사용자가 장바구니를 조회하면 오류를 반환한다

**수량 변경 실패**
- 존재하지 않는 장바구니 항목의 수량을 변경하면 오류를 반환한다
- 재고보다 많은 수량으로 변경하면 오류를 반환한다

### 비기능적 요구사항 (Non-Functional Requirements)

**성능**
- 장바구니 조회 응답 시간: 300ms 이내
- 상품 추가 응답 시간: 500ms 이내
- 장바구니 저장은 1초 이내에 완료되어야 한다 (완료되지 않으면 오류로 간주한다)

### 오류 코드 정의

| 케이스 | 설명 | HTTP 상태코드 | 에러 메시지 |
|--------|------|---------------|-------------|
| 미로그인 | 인증 헤더 없음 | 401 UNAUTHORIZED | "로그인이 필요한 서비스입니다." |
| 상품 미존재 | 잘못된 productId | 404 NOT FOUND | "상품을 찾을 수 없습니다." |
| 옵션 조합 미존재 | 잘못된 옵션 조합 | 404 NOT FOUND | "해당 옵션 조합의 상품을 찾을 수 없습니다." |
| 상품이 판매중 상태가 아님 | 상품이 판매중 외 상태 | 409 CONFLICT | "현재 판매 중이 아닌 상품입니다." |
| 재고 부족 | 요청 수량이 재고보다 많음 | 409 CONFLICT | "재고가 부족합니다. (현재 재고: {수량})" |
| 장바구니 저장 중 예외 | DB 연결 실패, Transaction 실패 | 500 INTERNAL SERVER ERROR | "장바구니 저장 중 오류가 발생했습니다." |
| 장바구니 항목 미존재 | 존재하지 않는 장바구니 항목 수정/삭제 | 404 NOT FOUND | "장바구니 항목을 찾을 수 없습니다." |

## 주문 / 결제

### 기능적 요구사항 (Functional Requirements)

#### < Happy Path > = 낙관적으로 동작하기를 기대하는 케이스

**주문 생성**
- 로그인한 사용자는 장바구니의 상품들로 주문을 생성할 수 있다
- 주문 시 배송지 정보를 입력할 수 있다
- 주문 시 결제 수단을 선택할 수 있다 (신용카드, 포인트, 카드+포인트)
- 주문 생성 시 재고와 포인트가 자동으로 차감된다

**결제 처리**
- 신용카드 결제는 외부 결제 시스템과 연동하여 처리된다
- 포인트 결제는 내부 포인트 시스템에서 처리된다
- 결제 성공 시 주문 상태가 '결제완료'로 변경된다
- 결제 실패 시 주문 상태가 '결제실패'로 변경되고 재고와 포인트가 복구된다

**주문 조회**
- 사용자는 자신의 주문 목록을 조회할 수 있다
- 사용자는 주문 상세 정보를 조회할 수 있다
- 주문 상태별로 필터링할 수 있다 (결제완료, 배송중, 배송완료 등)
- 주문 목록은 페이지네이션을 지원한다

**주문 취소**
- 결제완료 상태의 주문은 취소할 수 있다
- 주문 취소 시 재고와 포인트가 자동으로 복구된다
- 주문 취소 시 결제 취소가 외부 시스템을 통해 처리된다

**배송지 변경**
- 배송 시작 전까지는 배송지를 변경할 수 있다
- 배송지 변경 시 배송비가 재계산된다 (배송지에 따라 배송비가 다를 수 있음)

#### < Fail Cases > = 실패 케이스

**주문 생성 실패**
- 로그인하지 않은 사용자가 주문을 생성하면 오류를 반환한다
- 장바구니가 비어있으면 주문을 생성할 수 없다
- 재고가 부족한 상품이 있으면 주문을 생성할 수 없다
- 보유 포인트보다 높은 포인트를 사용하면 오류를 반환한다
- 배송지 정보가 누락되면 주문을 생성할 수 없다

**결제 처리 실패**
- 외부 결제 시스템 오류 시 결제가 실패한다
- 결제 중 네트워크 오류가 발생하면 결제가 실패한다

**주문 취소 실패**
- 배송이 시작된 주문은 취소할 수 없다
- 이미 취소된 주문은 다시 취소할 수 없다
- 외부 결제 시스템 오류로 인해 결제 취소가 실패할 수 있다

**배송지 변경 실패**
- 배송이 시작된 주문의 배송지는 변경할 수 없다
- 결제가 완료되지 않은 주문의 배송지는 변경할 수 없다
- 이미 취소된 주문의 배송지는 변경할 수 없다
- 배송지 정보가 유효하지 않으면 변경할 수 없다

### 비기능적 요구사항 (Non-Functional Requirements)

**성능**
- 주문 생성 응답 시간: 3초 이내
- 주문 조회 응답 시간: 500ms 이내
- 결제 처리 응답 시간: 10초 이내
- 동시 주문 처리: 100건/분 지원

**특화 요구사항**
- 외부 시스템 연동 실패 시 명확한 오류 메시지를 제공해야 한다
- 결제 시스템 장애 시 주문 생성이 중단되어야 한다
- 결제 정보는 암호화되어 전송되어야 한다
- 결제 취소는 적절한 권한 검증을 거쳐야 한다
- 주문 생성 시 재고, 포인트, 주문 정보의 트랜잭션 일관성이 보장되어야 한다
- 결제 실패 시 모든 관련 데이터가 롤백되어야 한다
- 동시 주문으로 인한 재고 중복 차감이 발생하지 않아야 한다

### 오류 코드 정의

| 케이스 | 설명 | HTTP 상태코드 | 에러 메시지 |
|--------|------|---------------|-------------|
| 미로그인 | 인증 헤더 없음 | 401 UNAUTHORIZED | "로그인이 필요한 서비스입니다." |
| 장바구니 비어있음 | 장바구니에 상품이 없음 | 400 BAD REQUEST | "장바구니가 비어있습니다." |
| 재고 부족 | 주문 상품의 재고 부족 | 409 CONFLICT | "재고가 부족한 상품이 있습니다." |
| 포인트 부족 | 보유 포인트보다 많은 포인트 사용 | 409 CONFLICT | "보유 포인트가 부족합니다." |
| 배송지 정보 누락 | 필수 배송지 정보 누락 | 400 BAD REQUEST | "배송지 정보를 입력해주세요." |
| 주문 미존재 | 잘못된 orderId | 404 NOT FOUND | "주문을 찾을 수 없습니다." |
| 주문 상태 변경 불가 | 배송 시작된 주문 취소/변경 시도 | 409 CONFLICT | "배송이 시작되어 변경할 수 없습니다." |
| 외부 결제 시스템 오류 | 결제 시스템 연동 실패 | 502 BAD GATEWAY | "결제 시스템 오류가 발생했습니다." |
| 결제 취소 실패 | 외부 시스템 결제 취소 실패 | 502 BAD GATEWAY | "결제 취소 중 오류가 발생했습니다." |
| 주문 생성 중 예외 | DB 연결 실패, Transaction 실패 | 500 INTERNAL SERVER ERROR | "주문 생성 중 오류가 발생했습니다." |
